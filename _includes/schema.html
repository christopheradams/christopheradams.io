{%- comment -%}
JSON-LD Structured Data for SEO
Supports WebSite, WebPage, Article/BlogPosting, Person, and BreadcrumbList schemas
{%- endcomment -%}

{%- assign page_title = page.title | default: site.title | escape -%}
{%- assign page_description = page.description | default: site.description | strip | escape -%}
{%- assign page_url = page.url | absolute_url -%}
{%- assign page_image = page.image.path | default: page.image | default: site.image -%}
{%- unless page_image contains "://" -%}
{%- assign page_image = page_image | absolute_url -%}
{%- endunless -%}

{%- comment -%} WebSite Schema (for homepage) {%- endcomment -%}
{%- if page.url == "/" or page.url == "/index.html" -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ site.title | jsonify }},
  "url": {{ site.url | jsonify }},
  "description": {{ site.description | jsonify }},
  "author": {
    "@type": "Person",
    "name": {{ site.author.name | default: site.author | jsonify }},
    "url": {{ site.author.uri | default: site.url | jsonify }}
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ site.url }}/archives/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{%- endif -%}

{%- comment -%} BreadcrumbList Schema {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ site.url | jsonify }}
    }
    {%- if page.url != "/" and page.url != "/index.html" -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ page_title | jsonify }},
      "item": {{ page_url | jsonify }}
    }
    {%- endif -%}
  ]
}
</script>

{%- comment -%} Article/BlogPosting Schema (for posts) {%- endcomment -%}
{%- if page.layout == 'post' or page.collection == 'posts' -%}
{%- assign post_author = page.author | default: site.author -%}
{%- if post_author -%}
{%- assign author_data = site.data.authors[post_author] | default: post_author -%}
{%- endif -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ page_url | jsonify }}
  },
  "headline": {{ page_title | jsonify }},
  "description": {{ page_description | jsonify }},
  "image": {{ page_image | jsonify }},
  "datePublished": {{ page.published_at | default: page.date | date_to_xmlschema | jsonify }},
  "dateModified": {{ page.last_modified_at | default: page.published_at | default: page.date | date_to_xmlschema | jsonify }},
  "author": {
    "@type": "Person",
    "name": {{ author_data.name | default: author_data | default: site.author.name | jsonify }},
    "url": {{ author_data.uri | default: site.author.uri | default: site.url | jsonify }}
  },
  "publisher": {
    "@type": "Person",
    "name": {{ site.author.name | default: site.author | jsonify }},
    "url": {{ site.url | jsonify }}
  }
  {%- if page.category -%}
  ,"articleSection": {{ page.category | jsonify }}
  {%- endif -%}
  {%- if page.tags.size > 0 -%}
  ,"keywords": {{ page.tags | join: ", " | jsonify }}
  {%- endif -%}
  {%- if page.location -%}
  ,"contentLocation": {
    "@type": "Place",
    "name": {{ page.location | jsonify }}
  }
  {%- endif -%}
}
</script>
{%- elsif page.layout == 'article' or page.layout == 'page' -%}
{%- comment -%} Article Schema (for pages) {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ page_url | jsonify }}
  },
  "headline": {{ page_title | jsonify }},
  "description": {{ page_description | jsonify }},
  "image": {{ page_image | jsonify }},
  "author": {
    "@type": "Person",
    "name": {{ site.author.name | default: site.author | jsonify }},
    "url": {{ site.author.uri | default: site.url | jsonify }}
  },
  "publisher": {
    "@type": "Person",
    "name": {{ site.author.name | default: site.author | jsonify }},
    "url": {{ site.url | jsonify }}
  }
}
</script>
{%- endif -%}

{%- comment -%} Person Schema (for About page) {%- endcomment -%}
{%- if page.url contains "/about" -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": {{ site.author.name | default: site.author | jsonify }},
  "url": {{ site.author.uri | default: site.url | jsonify }},
  "email": {{ site.email | jsonify }},
  "jobTitle": "Art Producer and Computer Programmer",
  "sameAs": [
    {%- for social in site.social_links -%}
    {{ social.url | jsonify }}{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ]
}
</script>
{%- endif -%}
